<mtx-popover #partyPopover
  [position]="['after','center']"
  [enterDelay]="0"
  [arrowWidth]="24"
  [arrowHeight]="24"
  class="dftwa-posterlist-itemcard-popover">
  <div class="flex flex-col overflow-y-auto scrollbar-thin scrollbar-thumb-rounded">
    @for (it of item().parties; track $index) {
      <div class="flex items-center my-1">
        <img class="rounded-full h-5 w-5" [src]="it.logoUrl" alt="{{it.name}}">
        <span class="ms-2 text-sm">({{it.shortName}})
          {{
            it.name.length > 25
              ? (it.name | slice:0:25) + '...'
              : it.name
          }}
        </span>
      </div>
    }
  </div>
</mtx-popover>

<mtx-popover #categoryPopover
  [position]="['after','center']"
  [enterDelay]="0"
  [arrowWidth]="24"
  [arrowHeight]="24"
  class="dftwa-posterlist-itemcard-popover">
  <div class="flex flex-col overflow-y-auto scrollbar-thin scrollbar-thumb-rounded">
    @for (it of item().categories; track $index) {
      <span class="ms-2 text-sm">{{it.name}}</span>
    }
  </div>
</mtx-popover>

<mtx-popover #languagePopover
  [position]="['after','center']"
  [enterDelay]="0"
  [arrowWidth]="24"
  [arrowHeight]="24"
  class="dftwa-posterlist-itemcard-popover">
  <div class="flex flex-col overflow-y-auto scrollbar-thin scrollbar-thumb-rounded">
    @for (it of item().languages; track $index) {
      <span class="ms-2 text-sm">{{it.name}}</span>
    }
  </div>
</mtx-popover>

<mat-card class="!rounded-bl-lg !rounded-br-lg" appearance="outlined"
  (mouseenter)="isHoverActive.set(true)"
  (mouseleave)="onMouseLeave()">
  <div class="relative">
    <div class="aspect-[1/1] min-h-[220px] relative cursor-pointer flex items-center rounded-tl-lg rounded-tr-lg justify-center overflow-hidden">
      <!-- Blurred background (z-0) -->
      @if (item().type.toLowerCase() === 'video') {
        <div
          class="absolute inset-4 bg-center bg-cover blur-2xl scale-110 brightness-95 z-0"
          style="background-image: url('{{ item().posterUrl || '/img/logo.png' }}')">
        </div>
      }

      <!-- Main image (z-10 so it stays sharp) -->
      <img
        class="relative z-[1] max-w-full max-h-full object-contain
              [mask-image:linear-gradient(to_right,transparent,black_3%,black_97%,transparent)]
              [-webkit-mask-image:linear-gradient(to_right,transparent,black_3%,black_97%,transparent)]"
        [src]="item().posterUrl || '/img/logo.png'"
        alt="poster"
      />
    </div>
    <!-- poster -->


    <div class="top-overlay absolute rounded-tl-lg rounded-tr-lg top-0 left-0 right-0 flex z-[2]"
      [class.show]="isHoverActive()">
      <div class="actions flex pt-1 justify-end grow px-1">
        <a mat-icon-button
          class="p-2 !text-white"
          matTooltip="Quick Edit"
          href="#">
          <mat-icon>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M450-420q38 0 64-26t26-64q0-38-26-64t-64-26q-38 0-64 26t-26 64q0 38 26 64t64 26Zm193 160L538-365q-20 13-42.5 19t-45.5 6q-71 0-120.5-49.5T280-510q0-71 49.5-120.5T450-680q71 0 120.5 49.5T620-510q0 23-6.5 45.5T594-422l106 106-57 56ZM200-120q-33 0-56.5-23.5T120-200v-160h80v160h160v80H200Zm400 0v-80h160v-160h80v160q0 33-23.5 56.5T760-120H600ZM120-600v-160q0-33 23.5-56.5T200-840h160v80H200v160h-80Zm640 0v-160H600v-80h160q33 0 56.5 23.5T840-760v160h-80Z"/></svg>
          </mat-icon>
        </a>
      </div>
    </div>
    <!-- top overlay -->

    <div class="absolute top-1 left-0 ps-2 checkbox z-[2]"
      [class.show]="isHoverActive() || isSelected()">
      <mat-checkbox [checked]="isSelected()"
        (change)="onCheckboxChanged($event.checked)">
      </mat-checkbox>
    </div>
    <!-- checkbox -->

    <div class="absolute top-0 left-0 right-0 flex justify-center gap-3 z-[2]">
      @if(item().isActive === false) {
        <!-- IN-ACTIVE Tag -->
        <span class="relative bg-red-600 text-white text-xs font-bold px-5 py-1 rounded-b-full shadow-md shadow-gray-400/50">
          IN-ACTIVE
        </span>
      } @else if (item().isPublished === false) {
        <!-- DRAFT Tag -->
        <span class="relative bg-blue-600 text-white text-xs font-bold px-5 py-1 rounded-b-full shadow-md shadow-gray-400/50">
          DRAFT
        </span>
      } @else if (pendingPublish()) {
        <!-- PENDING - PUBLISH Tag -->
        <span class="relative bg-yellow-500 text-black text-xs font-bold px-5 py-1 rounded-b-full shadow-md shadow-gray-400/50">
          PENDING - PUBLISH
        </span>
      }
    </div>

    <div class="bottom-overlay absolute bottom-0 left-0 right-0 flex z-[2]"
      [class.show]="isHoverActive()">
      <div class="actions flex items-end pb-2 justify-end grow px-1">
        <a mat-icon-button
          class="p-2 !text-white"
          matTooltip="Details"
          href="#">
          <mat-icon>edit</mat-icon>
        </a>

        <a mat-icon-button
          class="p-2 ms-2 !text-white"
          matTooltip="Analytics"
          href="#">
          <mat-icon>equalizer</mat-icon>
        </a>

        <a mat-icon-button
          class="p-2 ms-2 !text-white"
          matTooltip="Options"
          [matMenuTriggerFor]="options">
          <mat-icon>more_vert</mat-icon>
        </a>

        <mat-menu #options
          xPosition="before"
          class="dftwa-posterlist-item-options-panel">
          <button mat-menu-item class="px-4">
            <mat-icon>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M450-420q38 0 64-26t26-64q0-38-26-64t-64-26q-38 0-64 26t-26 64q0 38 26 64t64 26Zm193 160L538-365q-20 13-42.5 19t-45.5 6q-71 0-120.5-49.5T280-510q0-71 49.5-120.5T450-680q71 0 120.5 49.5T620-510q0 23-6.5 45.5T594-422l106 106-57 56ZM200-120q-33 0-56.5-23.5T120-200v-160h80v160h160v80H200Zm400 0v-80h160v-160h80v160q0 33-23.5 56.5T760-120H600ZM120-600v-160q0-33 23.5-56.5T200-840h160v80H200v160h-80Zm640 0v-160H600v-80h160q33 0 56.5 23.5T840-760v160h-80Z"/></svg>
            </mat-icon>
            <span>Quick Edit</span>
          </button>

          <button mat-menu-item class="px-4">
            <mat-icon>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M160-120v-80h640v80H160Zm320-160L280-480l56-56 104 104v-408h80v408l104-104 56 56-200 200Z"/></svg>
            </mat-icon>
            <span>Download</span>
          </button>

          <button mat-menu-item class="px-4">
            <mat-icon>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
            </mat-icon>
            <span>Delete Forever</span>
          </button>

          <button mat-menu-item class="px-4" (click)="copyId(item().id)">
            <mat-icon>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/></svg>
            </mat-icon>
            <span>Copy ID</span>
          </button>
        </mat-menu>
      </div>
    </div>
    <!-- bottom overlay -->

    <div class="absolute bottom-3 left-0 ps-2 z-20">
      <div class="relative flex flex-row">
        @if(firstParty() && firstCategory()){
          <div class="rounded-full w-[30px] h-[30px] shadow-sm"
            matTooltipPosition="above"
            [matTooltip]="firstParty()?.tooltip">
            <img class="rounded-full" [src]="firstParty()?.logoUrl" />
          </div>
        }

        @if (firstCategory() && hasMoreParties()) {
          <div class="rounded-full w-[30px] h-[30px] shadow-sm bg-slate-300 ms-2 flex items-center cursor-pointer"
            [mtxPopoverTriggerFor]="partyPopover">
            <span class="flex-grow text-center text-xs font-bold">+{{(item().parties?.length ?? 0) - 1}}</span>
          </div>
        }
      </div>
    </div>
    <!-- political parties -->
  </div>

  <div class="flex flex-col pb-2 px-2 footer">
    <div class="flex justify-between my-3 items-center">
      @if (firstCategory()) {
        <div class="flex flex-row items-center text-xs">
          <span class="rounded-sm px-2 py-[2px] category-tag">
            {{firstCategory()?.name}}
          </span>

          @if(hasMoreCategories()) {
            <span class="rounded-sm px-2 py-[2px] ms-2 category-tag cursor-pointer"
              [mtxPopoverTriggerFor]="categoryPopover">
              + {{(item().categories?.length ?? 0) - 1}}
            </span>
          }
        </div>
      } @else if (firstParty()) {
        <div class="flex flex-row items-center">
          <div class="flex flex-row rounded-full category-tag text-xs">
            <img class="rounded-full h-5 w-5" [src]="firstParty()?.logoUrl" alt="{{firstParty()?.name}}">
            <span class="ms-1 me-2.5 leading-5" [matTooltip]="firstParty()?.name">{{firstParty()?.shortName}}</span>
          </div>

          @if (hasMoreParties()) {
            <div class="flex flex-row rounded-full items-center h-5 ms-2 category-tag text-xs">
              <span class="mx-2 leading-5">+{{(item().parties?.length ?? 0) - 1}}</span>
            </div>
          }
        </div>
      }

      <span>{{item().totalSize | fileSize }}</span>
    </div>
    <!-- categories/parties & file-size -->

    <div class="date flex justify-between mb-2">
      @if (item().isPublished) {
        <div class="flex items-center">
          <mat-icon class="!size-[14px] text-[14px]">calendar_month</mat-icon>
          <span class="ms-1">Published:</span>
        </div>
        <div>{{ item().publishedAt ?? item().createdAt  | date: 'dd MMM, yy hh:mm a' }}</div>
      } @else {
        <div class="flex items-center">
          <mat-icon class="!size-[14px] text-[14px]">calendar_month</mat-icon>
          <span class="ms-1">Created:</span>
        </div>
        <div>{{ item().createdAt | date: 'dd MMM, yy hh:mm a' }}</div>
      }
    </div>
    <!-- date -->

    <mat-divider></mat-divider>

    <div class="flex mt-2 justify-center items-center">
      <div class="flex items-center">
        @for (it of visibleLanguages(); track $index) {
          <span class="rounded-sm px-1 text-xs text-blue-800 border border-blue-200 ms-1"
            [matTooltip]="it.name">
            {{it.iconText}}
          </span>
        } @empty {
          <span class="rounded-sm px-1 text-xs text-blue-800 border border-blue-200">All Language</span>
        }

        @if (hasMoreLanguages()) {
          <span class="rounded-sm px-1 text-xs text-blue-800 border border-blue-200 ms-2 cursor-pointer"
            [mtxPopoverTriggerFor]="languagePopover">
            + {{(item().languages?.length ?? 0) - 8}}
          </span>
        }
      </div>

      @if (false) {
        <div class="flex items-center text-slate-500">
          <div class="flex items-center me-2"
            matTooltip="Total views"
            matTooltipPosition="above">
            <mat-icon class="!size-[18px] text-[18px]">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-72q-45 0-76.5-31.5T372-500q0-45 31.5-76.5T480-608q45 0 76.5 31.5T588-500q0 45-31.5 76.5T480-392Zm0 192q-146 0-266-81.5T40-500q54-137 174-218.5T480-800q146 0 266 81.5T920-500q-54 137-174 218.5T480-200Zm0-300Zm0 220q113 0 207.5-59.5T832-500q-50-101-144.5-160.5T480-720q-113 0-207.5 59.5T128-500q50 101 144.5 160.5T480-280Z"/></svg>
            </mat-icon>
            <span class="ms-1">254k</span>
          </div>
          <!-- views -->

          <div class="flex items-center"
            matTooltip="Total number of shares/downloads"
            matTooltipPosition="above">
            <mat-icon class="!size-[13px] text-[13px]">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M680-80q-50 0-85-35t-35-85q0-6 3-28L282-392q-16 15-37 23.5t-45 8.5q-50 0-85-35t-35-85q0-50 35-85t85-35q24 0 45 8.5t37 23.5l281-164q-2-7-2.5-13.5T560-760q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35q-24 0-45-8.5T598-672L317-508q2 7 2.5 13.5t.5 14.5q0 8-.5 14.5T317-452l281 164q16-15 37-23.5t45-8.5q50 0 85 35t35 85q0 50-35 85t-85 35Zm0-80q17 0 28.5-11.5T720-200q0-17-11.5-28.5T680-240q-17 0-28.5 11.5T640-200q0 17 11.5 28.5T680-160ZM200-440q17 0 28.5-11.5T240-480q0-17-11.5-28.5T200-520q-17 0-28.5 11.5T160-480q0 17 11.5 28.5T200-440Zm480-280q17 0 28.5-11.5T720-760q0-17-11.5-28.5T680-800q-17 0-28.5 11.5T640-760q0 17 11.5 28.5T680-720Zm0 520ZM200-480Zm480-280Z"/></svg>
            </mat-icon>
            <span class="ms-1">254k</span>
          </div>
          <!-- shares -->
        </div>
      }
    </div>
  </div>
</mat-card>


